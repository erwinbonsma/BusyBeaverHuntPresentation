for(var h="function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,a){b!=Array.prototype&&b!=Object.prototype&&(b[c]=a.value)},k="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,l=["Array","prototype","fill"],m=0;m<l.length-1;m++){var n=l[m];n in k||(k[n]={});k=k[n]}
var p=l[l.length-1],q=k[p],r=function(b){return b?b:function(c,a,b){var d=this.length||0;0>a&&(a=Math.max(0,d+a));if(null==b||b>d)b=d;b=Number(b);0>b&&(b=Math.max(0,d+b));for(a=Number(a||0);a<b;a++)this[a]=c;return this}}(q);r!=q&&null!=r&&h(k,p,{configurable:!0,writable:!0,value:r});var t=[0,1,0,-1],u=[1,0,-1,0],v="#0000FF #6A00FF #D500FF #FF00BD #FF0052 #FF1800 #FF8300 #FFFF00".split(" ");function w(){this.i=0;this.j=-1;this.dir=0}w.prototype.step=function(){this.i+=t[this.dir];this.j+=u[this.dir]};
w.prototype.toString=function(){return"[x = "+this.i+", y = "+this.j+", dir = "+this.dir+"]"};function x(b){this.c=b;this.reset()}x.prototype.reset=function(){this.a=this.b=0;this.data=[];this.o=this.dp=this.data[0]=0};x.prototype.value=function(){return this.data[this.dp]};function y(b,c){return c<b.b||c>b.a?0:b.data[c]}x.prototype.toString=function(){for(var b="",c=this.b;c<=this.a;)""!=b&&(b+=","),c==this.dp?b+="["+this.data[c]+"]":b+=this.data[c],c++;return b};
function aa(b){this.l=this.u=b;this.count=1}function z(b,c){this.width=b;this.height=c;this.s=[];this.v=[];for(c=0;c<b;c++)this.s[c]=[],this.v[c]=[];this.reset()}z.prototype.reset=function(){for(var b=0;b<this.width;b++)for(var c=0;c<this.height;c++)this.s[b][c]=0,this.v[b][c]=0};function A(b,c){if(0!=c){for(var a=b.a,d=void 0;a&&a.l<c;)d=a,a=a.next;a&&a.u<=c?a.count+=1:a&&c==a.u-1?(a.count+=1,a.u=c):a&&c==a.l+1?(a.count+=1,a.l=c):(c=new aa(c),d?d.next=c:b.a=c,c.next=a)}}
function B(b,c){a:{b=b.a;for(var a=0;b;){if(c>=b.u&&c<=b.l){c=a;break a}a++;b=b.next}console.log("Did not find bucket for count = "+c);c=void 0}8<=c&&(c=7);return v[c]}z.prototype.dump=function(){for(var b=this.a,c="";b;)0<c.length&&(c+=" "),c+=b.u+"-"+b.l+"("+b.count+")",b=b.next;console.log(c)};function C(b,c,a){this.width=b;this.height=c;this.data=new x(a);this.A=new z(b,c);this.a=[];for(a=0;a<b;a++){this.a[a]=[];for(var d=0;d<c;d++)this.a[a][d]=0}this.reset()}
C.prototype.reset=function(){this.data.reset();this.A.reset();this.h=new w;this.w=this.status=0};function D(b,c,a){return 0>c||c>=b.width||0>a||a>=b.height?3:b.a[c][a]}
C.prototype.step=function(){0==this.status&&(this.status=1);if(1==this.status){do{var b=this.h.i+t[this.h.dir];var c=this.h.j+u[this.h.dir];var a=D(this,b,c);switch(a){case 3:this.status=2;break;case 1:switch(this.h.dir){case 0:var d=this.data;d.data[d.dp]+=1;d.o++;break;case 2:d=this.data;--d.data[d.dp];d.o++;break;case 1:a:{d=this.data;d.dp++;d.o++;if(d.dp>d.a)if(d.a-d.b<d.c)d.a=d.dp,d.data[d.dp]=0;else{console.log("Data limit reached");d=!1;break a}d=!0}d||(this.status=3);break;case 3:a:{d=this.data;
d.dp--;d.o++;if(d.dp<d.b)if(d.a-d.b<d.c)d.b=d.dp,d.data[d.dp]=0;else{console.log("Data limit reached");d=!1;break a}d=!0}d||(this.status=3)}break;case 2:0==this.data.value()?(d=this.h,d.dir=(d.dir+3)%4):(d=this.h,d.dir=(d.dir+1)%4)}}while(2==a);if(2!=this.status&&0<this.w)switch(a=this.A,d=this.h,d.dir){case 0:a.v[d.i][d.j]++;break;case 2:a.v[d.i][d.j-1]++;break;case 1:a.s[d.i][d.j]++;break;case 3:a.s[d.i-1][d.j]++}this.h.i=b;this.h.j=c;this.w++}};
function E(b){this.data=b;this.b=document.getElementById("dataCanvas");this.c=this.b.getContext("2d");this.c.font="24px Arial";this.a=this.f=0;this.g=!1}E.prototype.freeze=function(){this.g=!0};function F(b,c){return b.c.measureText(y(b.data,c)).width}function G(b,c,a,d){for(var e=b.b.width;0>d&&0<=c||0<d&&c<e;){var g=F(b,a)+6,f=b,S=a==b.data.dp?"#000000":"#B0B0B0";f.c.strokeStyle=S;f.c.fillStyle=S;0>d&&(c-=g);b.c.fillText(y(b.data,a),c,20);0<d&&(c+=g);a+=d}}
function ba(b){this.b=b;this.f=document.getElementById("programCanvas");this.a=this.f.getContext("2d");b=this.f.width/(this.b.width+1);var c=this.f.height/(this.b.height+1);this.c=b<c?b:c;this.B=.4*this.c;this.g=.2*this.c;this.m=1*this.g}function H(b,c){return 0>c?.4*b.c:c>=b.b.width?(b.b.width+.6)*b.c:(c+1)*b.c}function I(b,c){return 0>c?(b.b.height+.6)*b.c:c>=b.b.height?.4*b.c:(b.b.height-c)*b.c}
function J(b,c,a,d,e){c=H(b,c);a=I(b,a);d=H(b,d);e=I(b,e);b.a.beginPath();b.a.moveTo(c,a);b.a.lineTo(d,e);b.a.stroke()}function K(b,c,a,d){b.a.fillStyle=d;b.a.strokeStyle="#404040";b.a.beginPath();b.a.arc(H(b,c),I(b,a),b.B,0,2*Math.PI);b.a.closePath();b.a.fill();b.a.stroke()}
function L(b){this.a=b;this.D=new ba(b);this.c=new E(b.data);this.b=!0;this.f=0;M(this,4);document.getElementById("speed-slider").value=this.F;var c=this;setInterval(function(){var a=0==c.a.status||1==c.a.status;document.getElementById("reset-button").disabled=0==c.a.status;document.getElementById("step-button").disabled=!a||!c.b;document.getElementById("play-button").disabled=!a||!c.b;document.getElementById("pause-button").disabled=c.b;a=c.D;if(a.b.w!=a.C){a.C=a.b.w;a.a.fillStyle="#FFFFFF";a.a.fillRect(0,
0,a.f.width,a.f.height);a.a.lineWidth=1;a.a.strokeStyle="#808080";for(var b=0;b<a.b.width;b++)J(a,b,0,b,a.b.height-1);for(b=0;b<a.b.height;b++)J(a,0,b,a.b.width-1,b);a.a.lineWidth=1;b=a.b.A;a.a.lineWidth=4;a.a.lineCap="round";for(var e=0;e<a.b.width;e++)for(var g=0;g<a.b.height;g++){if(e<a.b.width-1){var f=b.s[e][g];0<f&&(a.a.strokeStyle=B(b,f),J(a,e,g,e+1,g))}g<a.b.height-1&&(f=b.v[e][g],0<f&&(a.a.strokeStyle=B(b,f),J(a,e,g,e,g+1)))}a.a.lineWidth=1;a.a.lineCap="butt";for(b=0;b<a.b.width;b++)for(f=
0;f<a.b.height;f++)switch(D(a.b,b,f)){case 1:K(a,b,f,"#FFFFFF");break;case 2:K(a,b,f,"#000000")}if(0!=a.b.status){switch(a.b.status){case 3:a.a.fillStyle="#FF0000";break;case 1:a.a.fillStyle="#404040";break;case 2:a.a.fillStyle="#808080"}a.a.strokeStyle="#000000";b=H(a,a.b.h.i);f=I(a,a.b.h.j);a.a.save();a.a.translate(b,f);a.a.rotate(.5*Math.PI*a.b.h.dir);a.a.translate(0,-.2*a.g);a.a.beginPath();a.a.moveTo(0,-a.g);a.a.lineTo(-a.m,a.g);a.a.lineTo(a.m,a.g);a.a.lineTo(0,-a.g);a.a.fill();a.a.stroke();
a.a.restore();a.a.font="16px Arial";a.a.fillStyle="#000000";b=a.b.w;a.a.fillText(b,a.f.width-a.a.measureText(b).width,16)}}a:{a=c.c;if(a.data.dp!=a.f){b=a.data.dp;f=b>a.f?1:-1;g=a.f;e=0+F(a,g)/2;e+=6;for(g+=f;g!=b;)e+=F(a,g),e+=6,g+=f;e+=F(a,g)/2;a.a+=f*e;a.f=b}else if(.2<Math.abs(a.a))a.g||(a.a=4*a.a/5);else if(a.data.o==a.m)break a;a.m=a.data.o;a.c.fillStyle="#FFFFFF";a.c.fillRect(0,0,a.b.width,a.b.height);b=(a.b.width-F(a,a.f))/2;a.a>a.b.width/2?a.a=a.b.width/2:a.a<-a.b.width/2&&(a.a=-a.b.width/
2);b+=a.a;G(a,b,a.data.dp,1);G(a,b,a.data.dp-1,-1)}if(!c.b&&++c.f>=c.g){for(a=c.m;0<a--;)c.a.step();N(c);c.f=0}},40);ca(this)}function ca(b){b.c.b.onmousedown=function(){function c(a){b.c.a+=a.movementX}function a(){document.removeEventListener("mousemove",c);document.removeEventListener("mouseup",a);b.c.g=!1}b.b&&(b.c.freeze(),document.addEventListener("mousemove",c),document.addEventListener("mouseup",a))}}
function N(b){var c=b.a.A;c.a=void 0;for(var a=0;a<c.width;a++)for(var d=0;d<c.height;d++)A(c,c.s[a][d]),A(c,c.v[a][d]);c=c.a;for(a=void 0;c;)a&&1>=c.u-a.l?(a.l=c.l,a.count+=c.count,a.next=c.next):a=c,c=c.next;1!=b.a.status&&(b.b=!0)}L.prototype.step=function(){this.a.step();N(this)};L.prototype.reset=function(){this.a.reset();this.b=!0};L.prototype.C=function(){this.b=!1};L.prototype.B=function(){this.b=!0};function M(b,c){b.F=c;5>c?(b.g=1<<5-c,b.m=1):(b.g=1,b.m=1<<c-5)}
L.prototype.G=function(){M(this,document.getElementById("speed-slider").value)};L.prototype.dump=function(){console.log("data = "+this.a.data.toString());this.a.A.dump()};(function(b){b.URLSearchParams=b.URLSearchParams||function(b){var a=this;a.H=b;a.get=function(b){return(b=(new RegExp("[?&]"+b+"=([^&#]*)")).exec(a.H))?decodeURI(b[1])||0:null}}})(window);var O;
a:{var P=new URLSearchParams(window.location.search),Q=parseInt(P.get("w"),10)||0,R=parseInt(P.get("h"),10)||0,T=P.get("p")||"*_*__o___*o____o*_ooo__*_";if(0==Q||0==R){var U=T.length;0==Q&&0==R?R=Q=Math.round(Math.sqrt(U)):0==Q?Q=Math.round(U/R):R=Math.round(U/Q);if(R*Q!=U){console.log("Cannot automatically infer program dimensions");O=void 0;break a}}var V=new C(Q,R,4096),W=0,X=V.height-1,Y=0;if(T.length!=V.width*V.height)console.log("Computer string length invalid");else{for(;Y<T.length;){var Z=
0;switch(T[Y++]){case "_":Z=0;break;case "o":Z=1;break;case "*":Z=2;break;default:console.log("Invalid character in program string")}V.a[W++][X]=Z;W==V.width&&(W=0,X--)}console.log("Program loaded")}O=new L(V)}window.computerControl=O;L.prototype.step=L.prototype.step;L.prototype.play=L.prototype.C;L.prototype.pause=L.prototype.B;L.prototype.reset=L.prototype.reset;L.prototype.updateRunSpeed=L.prototype.G;
